<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Corazon Math</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      background: #181818;
      color: white;
      padding: 10px;
      max-width: 800px;
      margin: 0 auto;
      font-family: Arial, sans-serif;
    }
    h2 {
      margin-bottom: 15px;
    }
    #sliderContainer {
      margin: 20px 0;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    #sliderA {
      flex-grow: 1;
      min-width: 150px;
      max-width: 400px;
      width: 100%;
    }
    #aValue {
      min-width: 30px;
      text-align: center;
    }
    #plot {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      /* Alto flexible para que se adapte según ancho */
      height: 0;
      padding-bottom: 60%; /* proporción 5:3 */
      position: relative;
    }
    #plot > div {
      /* El contenedor interno de Plotly se posiciona para llenar el área */
      position: absolute !important;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100% !important;
      height: 100% !important;
    }
  </style>
</head>
<body>
  <h2>Gráfica interactiva <span id="aLabel">(a = 21)</span></h2>
  <div id="sliderContainer">
    <input type="range" min="1" max="50" step="1" value="21" id="sliderA" />
    <span id="aValue">21</span>
  </div>
  <div id="plot"></div>

  <script>
    // Constantes
    const e = Math.E;
    const pi = Math.PI;
    const N = 400;

    function f(x, a) {
      const res = [];
      for(let i = 0; i < x.length; i++) {
        let xi = x[i];
        const root = pi - xi * xi;
        let s = NaN;
        if (root >= 0) {
          s = Math.pow(Math.abs(xi), 2 / 3) + (e / 3) * Math.sqrt(root) * Math.sin(a * pi * xi);
        }
        res.push(s);
      }
      return res;
    }

    const xMin = -Math.sqrt(pi);
    const xMax = Math.sqrt(pi);
    const x = Array.from({ length: N }, (_, i) => xMin + ((xMax - xMin) * i) / (N - 1));

    let a = 21;

    function plotFunction(a) {
      const y = f(x, a);
      const trace1 = {
        x: x,
        y: y,
        mode: 'lines',
        line: { color: 'pink', width: 2 },
        name: 'f(x)',
      };
      const trace2 = {
        x: x.map(v => -v),
        y: y,
        mode: 'lines',
        line: { color: 'pink', width: 2 },
        name: 'f(-x)',
      };

      const layout = {
        autosize: true,
        paper_bgcolor: '#181818',
        plot_bgcolor: '#181818',
        font: { color: 'white' },
        title: {
          text: 'f(x) = |x|^{2/3} + (e/3)·√(π-x²)·sin(a·π·x)',
          font: { size: 14, color: 'white' },
        },
        margin: { t: 50, b: 40, l: 50, r: 30 },
        xaxis: {
          title: 'x',
          color: 'white',
          zeroline: true,
          zerolinecolor: 'gray',
        },
        yaxis: {
          title: 'f(x)',
          color: 'white',
          zeroline: true,
          zerolinecolor: 'gray',
          autorange: true,
        },
      };

      const config = { responsive: true };

      Plotly.newPlot('plot', [trace1, trace2], layout, config);
    }

    plotFunction(a);

    // Interactividad del slider
    const sliderA = document.getElementById('sliderA');
    const aLabel = document.getElementById('aLabel');
    const aValue = document.getElementById('aValue');

    sliderA.addEventListener('input', () => {
      a = Number(sliderA.value);
      aLabel.textContent = `(a = ${a})`;
      aValue.textContent = a;
      plotFunction(a);
    });
    // Mejorar respuesta a cambio de tamaño de ventana
    window.addEventListener('resize', () => {
      Plotly.Plots.resize('plot');
    });
  </script>
</body>
</html>
